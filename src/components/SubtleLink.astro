---
const {
  href = "#",
  teksttype = "p_base_reg",
  display = "block",
  stylingclasses = "",
} = Astro.props;

const sizeClasses = {
  p_small_reg: "text-[14px] lg:text-[14px] font-normal",
  p_base_reg: "text-[16px] lg:text-[16px] font-normal",
  p_base_med: "text-[16px] lg:text-[16px] font-medium",
  p_large_reg: "text-[18px] lg:text-[18px] font-normal",
  p_large_med: "text-[18px] lg:text-[18px] font-medium",
};

// Normaliser paths så /foo og /foo/ matcher
const normalize = (p) => {
  if (!p) return "/";
  const noQuery = p.split("?")[0].split("#")[0];
  const trimmed = noQuery.replace(/\/+$/, "");
  return trimmed === "" ? "/" : trimmed;
};

const currentPath = normalize(Astro.url.pathname);

// Kun interne links kan være "active"
const isInternal = typeof href === "string" && href.startsWith("/");
const linkPath = isInternal ? normalize(href) : null;

// Active hvis det matcher præcist
const isActive = isInternal && linkPath === currentPath;
---

<a
  href={href}
  class:list={[
    display === "inline" ? "inline-block" : "block",
    "relative text-current",
    sizeClasses[teksttype],
    stylingclasses,
  ]}
  aria-current={isActive ? "page" : undefined}
>
  <span class="link-underline"><slot /></span>
</a>

<style>
  .link-underline {
    position: relative;
    display: inline-block;
  }

  .link-underline::after {
    content: "";
    position: absolute;
    left: 0;
    bottom: -2px;
    width: 0%;
    height: 1px;
    background: currentColor;
    transition: width 0.25s ease-out;
  }

  a:hover .link-underline::after {
    width: 100%;
  }

  /* “Active” (som menu-varianten): underline bliver stående */
  a[aria-current="page"] .link-underline::after {
    width: 100%;
  }
</style>
